/**
 * @file font.c
 */
#include "font.h"

#include <stdio.h>
#include <string.h>

#define START_BIT_INDEX_FONT                                                   \
  6 ///< Стартовый индекс для символа из symbols[] (индексы от 6 до 0).

/**
 * Параметры символа: символ и его бинарное представление.
 */
typedef struct {
  char symbol;
  uint8_t buff_code[BINARY_SYMBOL_SIZE];
} symbol_t;

/// Буфер символов
static symbol_t symbols[] = {
    // {'c',
    //  {// символ Пусто = ' '
    //   0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
    //   0b00000000, 0b00000000}},
    // {'>',
    //  {// одинарная стрелка вверх
    //   0b00010000, 0b00111000, 0b01010100, 0b00010000, 0b00010000, 0b00010000,
    //   0b00010000, 0b00010000}},
    // {'<',
    //  {// одинарная стрелка вниз
    //   0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b01010100,
    //   0b00111000, 0b00010000}},
    // {'0',
    //  {0b00110000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01001000,
    //   0b01001000, 0b00110000}},
    // {'1',
    //  {0b00100000, 0b01100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000,
    //   0b00100000, 0b01110000}},
    // {'2',
    //  {0b00110000, 0b01001000, 0b00001000, 0b00001000, 0b00010000, 0b00100000,
    //   0b01000000, 0b01111000}},
    // {'3',
    //  {0b01111000, 0b00001000, 0b00010000, 0b00110000, 0b00001000, 0b00001000,
    //   0b01001000, 0b00110000}},
    // {'4',
    //  {0b00001000, 0b00011000, 0b00101000, 0b01001000, 0b01111000, 0b00001000,
    //   0b00001000, 0b00001000}},
    // {'5',
    //  {0b01111000, 0b01000000, 0b01000000, 0b01110000, 0b00001000, 0b00001000,
    //   0b01001000, 0b00110000}},
    // {'6',
    //  {0b00110000, 0b01001000, 0b01000000, 0b01110000, 0b01001000, 0b01001000,
    //   0b01001000, 0b00110000}},
    // {'7',
    //  {0b01111000, 0b00001000, 0b00001000, 0b00010000, 0b00100000, 0b00100000,
    //   0b00100000, 0b00100000}},
    // {'8',
    //  {0b00110000, 0b01001000, 0b01001000, 0b00110000, 0b01001000, 0b01001000,
    //   0b01001000, 0b00110000}},
    // {'9',
    //  {0b00110000, 0b01001000, 0b01001000, 0b01001000, 0b00111000, 0b00001000,
    //   0b01001000, 0b00110000}},
    {'O',
     {0b00000000, 0b00110000, 0b01001000, 0b01001000, 0b01001000, 0b01001000,
      0b00110000, 0b00000000}},
    // {'K',
    //  {0b01000100, 0b01001000, 0b01010000, 0b01100000, 0b01100000, 0b01010000,
    //   0b01001000, 0b01000100}},
    {'-',
     {0b00000000, 0b00000000, 0b00000000, 0b01110000, 0b00000000, 0b00000000,
      0b00000000, 0b00000000}},
    // {'b',
    //  {0b01000000, 0b01000000, 0b01000000, 0b01110000, 0b01001000, 0b01001000,
    //   0b01001000, 0b00110000}},
    {'L',
     {0b01000000, 0b01000000, 0b01000000, 0b01000000, 0b01000000, 0b01000000,
      0b01001000, 0b01111000}},
    // {'A',
    //  {0b00110000, 0b01001000, 0b01001000, 0b01111000, 0b01001000, 0b01001000,
    //   0b01001000, 0b01001000}},
    {'P',
     {0b01110000, 0b01001000, 0b01001000, 0b01001000, 0b01110000, 0b01000000,
      0b01000000, 0b01000000}},
    {'H',
     {0b01001000, 0b01001000, 0b01001000, 0b01111000, 0b01001000, 0b01001000,
      0b01001000, 0b01001000}},
    // {'C',
    //  {0b00110000, 0b01001000, 0b01000000, 0b01000000, 0b01000000, 0b01000000,
    //   0b01001000, 0b00110000}},
    // {'E',
    //  {0b01111000, 0b01000000, 0b01000000, 0b01000000, 0b01111000, 0b01000000,
    //   0b01000000, 0b01111000}},
    // {'F',
    //  {0b01111000, 0b01000000, 0b01000000, 0b01000000, 0b01110000, 0b01000000,
    //   0b01000000, 0b01000000}},
    {'U',
     {0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01001000,
      0b01001000, 0b00110000}},
    {'p', // символ П
     {0b01111000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01001000,
      0b01001000, 0b01001000}},
    {'I',
     {0b01110000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000,
      0b00100000, 0b01110000}},
    {'D',
     {0b01110000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01001000,
      0b01001000, 0b01110000}},
    // {'S',
    //  {0b00110000, 0b01001000, 0b01000000, 0b00100000, 0b00010000, 0b00001000,
    //   0b01001000, 0b00110000}},
    // {'g',
    //  {// символ Г
    //   0b01111000, 0b01000000, 0b01000000, 0b01000000, 0b01000000, 0b01000000,
    //   0b01000000, 0b01000000}},
    {'+',
     {0b00000000, 0b00010000, 0b00010000, 0b01111100, 0b00010000, 0b00010000,
      0b00000000, 0b00000000}},
    // {'V',
    //  {0b01000100, 0b01000100, 0b01000100, 0b01000100, 0b01000100, 0b01000100,
    //   0b00101000, 0b00010000}},
    // {'T',
    //  {0b01111100, 0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b00010000,
    //   0b00010000, 0b00010000}},
    {'.',
     {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
      0b00000000, 0b01000000}},
    {'*', // символ для включения всех строк и колонок в DEMO_MODE
     {0B11111111, 0B11111111, 0B11111111, 0B11111111, 0B11111111, 0B11111111,
      0B11111111, 0B11111111}}

};

const uint8_t bitmap[NUMBER_OF_SYMBOLS][NUMBER_OF_ROWS] = {

    // Символ 0 (SYM_ZERO)
    {0b00110000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01001000,
     0b01001000, 0b00110000},

    // Символ 1 (SYM_ONE)
    {0b00100000, 0b01100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000,
     0b00100000, 0b01110000},

    // Символ 2 (SYM_TWO)
    {0b00110000, 0b01001000, 0b00001000, 0b00001000, 0b00010000, 0b00100000,
     0b01000000, 0b01111000},

    // Символ 3 (SYM_THREE)
    {0b01111000, 0b00001000, 0b00010000, 0b00110000, 0b00001000, 0b00001000,
     0b01001000, 0b00110000},

    // Символ 4 (SYM_FOUR)
    {0b00001000, 0b00011000, 0b00101000, 0b01001000, 0b01111000, 0b00001000,
     0b00001000, 0b00001000},

    // Символ 5 (SYM_FIVE)
    {0b01111000, 0b01000000, 0b01000000, 0b01110000, 0b00001000, 0b00001000,
     0b01001000, 0b00110000},

    // Символ 6 (SYM_SIX)
    {0b00110000, 0b01001000, 0b01000000, 0b01110000, 0b01001000, 0b01001000,
     0b01001000, 0b00110000},

    // Символ 7 (SYM_SEVEN)
    {0b01111000, 0b00001000, 0b00001000, 0b00010000, 0b00100000, 0b00100000,
     0b00100000, 0b00100000},

    // Символ 8 (SYM_EIGHT)
    {0b00110000, 0b01001000, 0b01001000, 0b00110000, 0b01001000, 0b01001000,
     0b01001000, 0b00110000},

    // Символ 9 (SYM_NINE)
    {0b00110000, 0b01001000, 0b01001000, 0b01001000, 0b00111000, 0b00001000,
     0b01001000, 0b00110000},

    {// Одинарная стрелка вверх (SYM_ARROW_UP)
     0b00010000, 0b00111000, 0b01010100, 0b00010000, 0b00010000, 0b00010000,
     0b00010000, 0b00010000},

    {// Одинарная стрелка вниз (SYM_ARROW_DOWN)
     0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b01010100,
     0b00111000, 0b00010000},

    // Символ A
    {0b00110000, 0b01001000, 0b01001000, 0b01111000, 0b01001000, 0b01001000,
     0b01001000, 0b01001000},

    // Символ b
    {0b01000000, 0b01000000, 0b01000000, 0b01110000, 0b01001000, 0b01001000,
     0b01001000, 0b00110000},

    // Символ C
    {0b00110000, 0b01001000, 0b01000000, 0b01000000, 0b01000000, 0b01000000,
     0b01001000, 0b00110000},

    // Символ d !!!
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ E
    {0b01111000, 0b01000000, 0b01000000, 0b01000000, 0b01111000, 0b01000000,
     0b01000000, 0b01111000},

    // Символ F
    {0b01111000, 0b01000000, 0b01000000, 0b01000000, 0b01110000, 0b01000000,
     0b01000000, 0b01000000},

    // Символ Пусто (SYM_EMPTY)
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ П
    {0b01111000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01001000,
     0b01001000, 0b01001000},

    // Символ P
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ п
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ H
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ U
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ - (минус)
    {0b00000000, 0b00000000, 0b00000000, 0b01110000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ _ !!!
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ u
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ L
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ У
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ Б
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ Г
    {0b01111000, 0b01000000, 0b01000000, 0b01000000, 0b01000000, 0b01000000,
     0b01000000, 0b01000000},

    // Символ R !!!
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ V
    {0b01000100, 0b01000100, 0b01000100, 0b01000100, 0b01000100, 0b01000100,
     0b00101000, 0b00010000},

    // Символ N !!!
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ S
    {0b00110000, 0b01001000, 0b01000000, 0b00100000, 0b00010000, 0b00001000,
     0b01001000, 0b00110000},

    // Символ K
    {0b01000100, 0b01001000, 0b01010000, 0b01100000, 0b01100000, 0b01010000,
     0b01001000, 0b01000100},

    // Символ Y !!!
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ G !!!
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ B !!!
    {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000,
     0b00000000, 0b00000000},

    // Символ T
    {0b01111100, 0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b00010000,
     0b00010000, 0b00010000},

};

/**
 * @brief  Преобразование десятичного числа в двоичный массив (для получения
 *         двоичных строк символа в drawing.c).
 * @param  number:     Число для двоичной строки символа.
 * @param  binary_mas: Указатель на массив с двоичным представлением строки
 *                     символа (из font.c symbols[]).
 * @param  bin_size:   Размер двоичной строки символа.
 * @retval None
 */
void convert_number_from_dec_to_bin(uint8_t number, uint8_t *binary_mas,
                                    uint8_t bin_size) {
  int8_t font_index = bin_size;
  uint8_t bit_num = 0;
  while (font_index != -1) {
    binary_mas[bit_num] = number % 2;
    number /= 2;
    font_index--;
    bit_num++;
  }
}

/**
 * @brief  Получение кода символа из массива symbols[].
 * @param  symbol:                 Символ из symbols[] (font.c).
 * @retval Указатель на buff_code: Код символа.
 */
uint8_t *get_symbol_code(char symbol) {
  for (uint8_t ind = 0; ind < sizeof(symbols) / sizeof(symbols[0]); ind++) {
    if (symbols[ind].symbol == symbol) {
      return symbols[ind].buff_code;
    }
  }
  return NULL;
}
